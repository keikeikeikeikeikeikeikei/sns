import{d as C,p as D,r as Q,c as i,a as t,u as e,e as u,n as V,t as n,b as g,F as $,j as F,f as M,g as S,v as j,o as r,i as N,h as z}from"./index-CzD91pAN.js";import{u as A}from"./useQueryClient-DaGhUnUp.js";import{u as B}from"./useQuery-BPQ3C_LI.js";import{u as f}from"./useMutation-BivMFSN2.js";import{a as m}from"./axios-instance-9reuLYs6.js";import{_ as v}from"./EmojiReactionBar.vue_vue_type_script_setup_true_lang-D0NIQmfL.js";const K={class:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100"},L={class:"sticky top-0 z-50 bg-white/80 backdrop-blur-lg border-b border-gray-200"},P={class:"max-w-4xl mx-auto px-4 py-3 flex items-center gap-4"},I={class:"max-w-4xl mx-auto px-4 py-6"},R={key:0,class:"text-center py-8"},T={key:1,class:"space-y-6"},E={class:"card"},J={class:"flex items-start gap-3 mb-4"},U={class:"text-xl font-bold text-gray-900 mb-4"},G={class:"prose prose-slate max-w-none mb-4 whitespace-pre-wrap"},H={class:"flex items-center gap-3 text-sm text-gray-500 border-t border-gray-100 pt-4"},O={class:"mt-4"},W={class:"space-y-4"},X={class:"font-semibold text-gray-700"},Y={key:0,class:"flex items-center gap-2 text-green-600 font-medium mb-3"},Z={class:"text-gray-800 whitespace-pre-wrap mb-4"},tt={class:"flex items-center justify-between"},et={class:"text-sm text-gray-500"},st=["onClick","disabled"],at={class:"mt-3"},ot={key:0,class:"card"},nt={class:"flex justify-end mt-3"},it=["disabled"],bt=C({__name:"QaDetailView",setup(rt){const h=D(),w=N(),p=A(),d=h.params.id,c=Q(""),{data:a,isLoading:k}=B({queryKey:["qa",d],queryFn:async()=>(await m.get(`/qa/${d}`)).data}),_=f({mutationFn:async l=>{await m.post(`/qa/${d}/answers`,{content:l})},onSuccess:()=>{c.value="",p.invalidateQueries({queryKey:["qa",d]})}}),b=f({mutationFn:async l=>{await m.put(`/qa/${d}/best-answer`,{answer_id:l})},onSuccess:()=>{p.invalidateQueries({queryKey:["qa",d]})}}),q=()=>{c.value.trim()&&_.mutate(c.value)},y=l=>new Date(l).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"});return(l,s)=>{var x;return r(),i("div",K,[t("header",L,[t("div",P,[t("button",{onClick:s[0]||(s[0]=o=>e(w).back()),class:"btn btn-ghost p-2"},[...s[2]||(s[2]=[t("i",{class:"pi pi-arrow-left"},null,-1)])]),s[3]||(s[3]=t("h1",{class:"text-lg font-semibold"},"Q&A",-1))])]),t("main",I,[e(k)?(r(),i("div",R,[...s[4]||(s[4]=[t("i",{class:"pi pi-spin pi-spinner text-2xl text-gray-400"},null,-1)])])):e(a)?(r(),i("div",T,[t("article",E,[t("div",J,[t("span",{class:V(["px-2 py-1 rounded text-xs font-medium",e(a).status==="resolved"?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"])},n(e(a).status==="resolved"?"解決済み":"受付中"),3)]),t("h2",U,n(e(a).title),1),t("div",G,n(e(a).content),1),t("div",H,[t("span",null,n(e(a).user.display_name),1),t("span",null,n(y(e(a).created_at)),1)]),t("div",O,[g(v,{"post-id":e(a).id,reactions:e(a).reaction_counts},null,8,["post-id","reactions"])])]),t("div",W,[t("h3",X,"回答 ("+n(((x=e(a).answers)==null?void 0:x.length)||0)+"件)",1),(r(!0),i($,null,F(e(a).answers,o=>(r(),i("div",{key:o.id,class:"card"},[o.is_best_answer?(r(),i("div",Y,[...s[5]||(s[5]=[t("i",{class:"pi pi-check-circle"},null,-1),z(" ベストアンサー ",-1)])])):u("",!0),t("p",Z,n(o.content),1),t("div",tt,[t("div",et,n(o.user.display_name)+" · "+n(y(o.created_at)),1),e(a).status==="open"&&!o.is_best_answer?(r(),i("button",{key:0,onClick:lt=>e(b).mutate(o.id),class:"btn btn-secondary text-sm",disabled:e(b).isPending.value}," ベストアンサーに選ぶ ",8,st)):u("",!0)]),t("div",at,[g(v,{"post-id":o.id,reactions:o.reaction_counts},null,8,["post-id","reactions"])])]))),128))]),e(a).status==="open"?(r(),i("div",ot,[s[6]||(s[6]=t("h3",{class:"font-semibold text-gray-700 mb-3"},"回答を投稿",-1)),t("form",{onSubmit:M(q,["prevent"])},[S(t("textarea",{"onUpdate:modelValue":s[1]||(s[1]=o=>c.value=o),class:"w-full p-3 border border-gray-200 rounded-lg resize-none focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none",rows:"4",placeholder:"回答を入力..."},null,512),[[j,c.value]]),t("div",nt,[t("button",{type:"submit",class:"btn btn-primary",disabled:!c.value.trim()||e(_).isPending.value}," 回答する ",8,it)])],32)])):u("",!0)])):u("",!0)])])}}});export{bt as default};
