import{d as k,r as b,c as o,o as a,a as e,b as $,T as R,w as O,e as _,f as F,g as X,v as W,n as w,t as p,u as y,h as C,i as M,F as T,j as I,k as L,l as j}from"./index-CzD91pAN.js";import{a as P}from"./axios-instance-9reuLYs6.js";import{u as Y}from"./useQueryClient-DaGhUnUp.js";import{u as E}from"./useQuery-BPQ3C_LI.js";import{u as Z}from"./useMutation-BivMFSN2.js";import{_ as G}from"./EmojiReactionBar.vue_vue_type_script_setup_true_lang-D0NIQmfL.js";const ee={class:"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden"},te={class:"flex items-center justify-between px-4 py-3 border-b border-gray-100"},se={class:"p-4"},ne={class:"flex justify-end mb-4"},ae={class:"p-3 rounded-lg border border-gray-200 bg-gray-50"},oe={class:"flex items-center gap-2 mb-2 text-sm text-gray-500"},le={class:"font-medium"},re={class:"text-gray-700 text-sm line-clamp-3"},ie={class:"flex justify-end gap-2 px-4 py-3 border-t border-gray-100 bg-gray-50"},de=["disabled"],ue={key:0,class:"pi pi-spin pi-spinner mr-2"},V=150,K=k({__name:"QuoteButton",props:{sourcePost:{}},setup(t){const v=t,d=Y(),m=b(!1),s=b(""),n=Z({mutationFn:async f=>(await P.post(`/posts/${v.sourcePost.id}/quotes`,{content:f})).data,onSuccess:()=>{m.value=!1,s.value="",d.invalidateQueries({queryKey:["feeds"]})}}),r=()=>{s.value.trim()&&s.value.length<=V&&n.mutate(s.value)},i=()=>v.sourcePost.type==="feed"?v.sourcePost.content||"":v.sourcePost.title||"",l=()=>V-s.value.length;return(f,u)=>(a(),o("div",null,[e("button",{onClick:u[0]||(u[0]=h=>m.value=!0),class:"inline-flex items-center gap-1 px-2 py-1 rounded-lg text-gray-500 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm",title:"引用"},[...u[5]||(u[5]=[e("i",{class:"pi pi-replay"},null,-1),e("span",{class:"hidden sm:inline"},"引用",-1)])]),$(R,{name:"fade"},{default:O(()=>[m.value?(a(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",onClick:u[4]||(u[4]=F(h=>m.value=!1,["self"]))},[e("div",ee,[e("div",te,[u[7]||(u[7]=e("h3",{class:"font-semibold text-gray-800"},"引用してつぶやく",-1)),e("button",{onClick:u[1]||(u[1]=h=>m.value=!1),class:"p-1 hover:bg-gray-100 rounded-full transition-colors"},[...u[6]||(u[6]=[e("i",{class:"pi pi-times text-gray-500"},null,-1)])])]),e("div",se,[X(e("textarea",{"onUpdate:modelValue":u[2]||(u[2]=h=>s.value=h),class:"w-full p-3 border border-gray-200 rounded-lg resize-none focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none mb-3",rows:"3",placeholder:"コメントを追加...",maxlength:V},null,512),[[W,s.value]]),e("div",ne,[e("span",{class:w(["text-sm",l()<20?"text-orange-500":"text-gray-400",l()<0?"text-red-500":""])},p(l()),3)]),e("div",ae,[e("div",oe,[e("span",le,p(t.sourcePost.user.display_name),1),e("span",null,"@"+p(t.sourcePost.user.username),1)]),e("p",re,p(i()),1)])]),e("div",ie,[e("button",{onClick:u[3]||(u[3]=h=>m.value=!1),class:"btn btn-secondary"}," キャンセル "),e("button",{onClick:r,class:"btn btn-primary",disabled:!s.value.trim()||l()<0||y(n).isPending.value},[y(n).isPending.value?(a(),o("i",ue)):_("",!0),u[8]||(u[8]=C(" 引用してつぶやく ",-1))],8,de)])])])):_("",!0)]),_:1})]))}}),ce={class:"flex gap-3"},me={class:"flex-shrink-0"},pe={class:"w-10 h-10 rounded-full bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white font-medium"},ge={class:"flex-1 min-w-0"},ve={class:"flex items-center gap-2 mb-1"},ye={class:"font-medium text-gray-900 truncate"},xe={class:"text-gray-400 text-sm"},fe={class:"text-gray-400 text-sm"},be={class:"text-gray-800 whitespace-pre-wrap break-words"},he=["src","onClick"],_e=k({__name:"FeedCard",props:{feed:{}},setup(t){const v=M(),d=s=>{const n=new Date(s),i=new Date().getTime()-n.getTime();return i<6e4?"たった今":i<36e5?`${Math.floor(i/6e4)}分前`:i<864e5?`${Math.floor(i/36e5)}時間前`:n.toLocaleDateString("ja-JP",{month:"short",day:"numeric"})},m=s=>{window.open(s,"_blank")};return(s,n)=>{var r,i;return a(),o("article",{class:"card card-hover",onClick:n[1]||(n[1]=l=>y(v).push(`/feed/${t.feed.id}`))},[e("div",ce,[e("div",me,[e("div",pe,p(((r=t.feed.user.display_name)==null?void 0:r.charAt(0))||t.feed.user.username.charAt(0)),1)]),e("div",ge,[e("div",ve,[e("span",ye,p(t.feed.user.display_name),1),e("span",xe," @"+p(t.feed.user.username),1),n[2]||(n[2]=e("span",{class:"text-gray-300"},"·",-1)),e("span",fe,p(d(t.feed.created_at)),1)]),e("p",be,p(t.feed.content),1),(i=t.feed.image_urls)!=null&&i.length?(a(),o("div",{key:0,class:w(["mt-3 grid gap-2",t.feed.image_urls.length===1?"grid-cols-1":"grid-cols-2"])},[(a(!0),o(T,null,I(t.feed.image_urls,(l,f)=>(a(),o("img",{key:f,src:l,class:w(["w-full rounded-lg object-cover cursor-pointer hover:opacity-90 transition-opacity",t.feed.image_urls.length===1?"max-h-80":"h-32"]),onClick:F(u=>m(l),["stop"]),alt:"Post image"},null,10,he))),128))],2)):_("",!0),e("div",{class:"mt-3 flex items-center gap-2",onClick:n[0]||(n[0]=F(()=>{},["stop"]))},[$(K,{"source-post":{id:t.feed.id,type:"feed",content:t.feed.content,user:t.feed.user}},null,8,["source-post"]),n[3]||(n[3]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),$(G,{"post-id":t.feed.id,reactions:t.feed.reaction_counts},null,8,["post-id","reactions"])])])])])}}}),$e={class:"space-y-3"},ke={key:0,class:"flex flex-wrap gap-2"},we=["src"],Ce=["onClick"],qe={key:0,class:"text-gray-500"},Pe={key:1},De={class:"text-xs text-gray-400 mt-1"},je=k({__name:"ImageUploader",props:{maxImages:{}},emits:["uploaded"],setup(t,{expose:v,emit:d}){const m=t,s=d,n=L(()=>m.maxImages??4),r=b([]),i=b(!1),l=b(!1),f=b(null),u=async c=>{var g,U;if(!(!c||c.length===0)&&!(r.value.length>=n.value)){i.value=!0;try{const q=new FormData,J=n.value-r.value.length;for(let A=0;A<Math.min(c.length,J);A++)q.append("images[]",c[A]);const H=await P.post("/upload/multiple",q,{headers:{"Content-Type":"multipart/form-data"}});H.data.urls&&(r.value=[...r.value,...H.data.urls],s("uploaded",r.value))}catch(q){console.error("Upload failed:",q),alert(((U=(g=q.response)==null?void 0:g.data)==null?void 0:U.error)||"アップロードに失敗しました")}finally{i.value=!1}}},h=c=>{var g;c.preventDefault(),l.value=!1,u(((g=c.dataTransfer)==null?void 0:g.files)||null)},S=c=>{c.preventDefault(),l.value=!0},Q=()=>{l.value=!1},B=()=>{var c;(c=f.value)==null||c.click()},N=c=>{const g=c.target;u(g.files),g.value=""},D=c=>{r.value.splice(c,1),s("uploaded",r.value)};return v({clear:()=>{r.value=[]},images:r}),(c,g)=>(a(),o("div",$e,[e("input",{ref_key:"fileInput",ref:f,type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",multiple:"",class:"hidden",onChange:N},null,544),r.value.length?(a(),o("div",ke,[(a(!0),o(T,null,I(r.value,(U,q)=>(a(),o("div",{key:U,class:"relative group"},[e("img",{src:U,class:"w-20 h-20 object-cover rounded-lg border border-gray-200",alt:"Uploaded image"},null,8,we),e("button",{onClick:J=>D(q),class:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[...g[0]||(g[0]=[e("i",{class:"pi pi-times text-xs"},null,-1)])],8,Ce)]))),128))])):_("",!0),r.value.length<n.value?(a(),o("div",{key:1,onDrop:h,onDragover:S,onDragleave:Q,onClick:B,class:w(["border-2 border-dashed rounded-lg p-4 text-center cursor-pointer transition-colors",l.value?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-gray-400"])},[i.value?(a(),o("div",qe,[...g[1]||(g[1]=[e("i",{class:"pi pi-spin pi-spinner text-xl"},null,-1),e("p",{class:"text-sm mt-1"},"アップロード中...",-1)])])):(a(),o("div",Pe,[g[2]||(g[2]=e("i",{class:"pi pi-image text-2xl text-gray-400"},null,-1)),g[3]||(g[3]=e("p",{class:"text-sm text-gray-500 mt-1"}," クリックまたはドラッグ&ドロップで画像を追加 ",-1)),e("p",De," JPEG, PNG, GIF, WebP (最大5MB, "+p(r.value.length)+"/"+p(n.value)+"枚) ",1)]))],34)):_("",!0)]))}}),Fe={class:"space-y-6"},Me={class:"card"},Te={class:"mt-3"},Ie={class:"flex items-center justify-between mt-3"},Se=["disabled"],Ue={key:0,class:"pi pi-spin pi-spinner mr-2"},Le={key:0,class:"text-center py-8 text-gray-500"},Qe={key:1,class:"space-y-4"},Be={class:"text-center text-sm text-gray-500"},Ne={key:0,class:"text-center"},Ae=["disabled"],Ve={key:0,class:"pi pi-spin pi-spinner mr-2"},ze={key:2,class:"text-center py-8 text-gray-500"},z=150,Ee=20,Ge=k({__name:"FeedTab",setup(t){const v=Y(),d=b(""),m=b([]),s=b(null),n=b(1),{data:r,isLoading:i,isFetching:l}=E({queryKey:["feeds",n],queryFn:async()=>(await P.get("/feeds",{params:{page:n.value,per_page:Ee}})).data}),f=L(()=>{var x;return((x=r.value)==null?void 0:x.data)??[]}),u=L(()=>{var x;return((x=r.value)==null?void 0:x.meta)??{current_page:1,last_page:1,total:0}}),h=L(()=>u.value.current_page<u.value.last_page),S=Z({mutationFn:async x=>(await P.post("/feeds",x)).data,onSuccess:()=>{var x;d.value="",m.value=[],(x=s.value)==null||x.clear(),n.value=1,v.invalidateQueries({queryKey:["feeds"]})}}),Q=()=>{d.value.trim()&&d.value.length<=z&&S.mutate({content:d.value,image_urls:m.value})},B=()=>{h.value&&!l.value&&n.value++},N=x=>{m.value=x},D=()=>z-d.value.length;return(x,c)=>(a(),o("div",Fe,[e("div",Me,[e("form",{onSubmit:F(Q,["prevent"])},[X(e("textarea",{"onUpdate:modelValue":c[0]||(c[0]=g=>d.value=g),class:"w-full p-3 border border-gray-200 rounded-lg resize-none focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none",rows:"3",placeholder:"いまどうしてる？",maxlength:z},null,512),[[W,d.value]]),e("div",Te,[$(je,{ref_key:"imageUploader",ref:s,"max-images":4,onUploaded:N},null,512)]),e("div",Ie,[e("span",{class:w(["text-sm",D()<20?"text-orange-500":"text-gray-400",D()<0?"text-red-500":""])},p(D()),3),e("button",{type:"submit",class:"btn btn-primary",disabled:!d.value.trim()||D()<0||y(S).isPending.value},[y(S).isPending.value?(a(),o("i",Ue)):_("",!0),c[1]||(c[1]=C(" 投稿 ",-1))],8,Se)])],32)]),y(i)?(a(),o("div",Le,[...c[2]||(c[2]=[e("i",{class:"pi pi-spin pi-spinner text-2xl"},null,-1)])])):f.value.length?(a(),o("div",Qe,[(a(!0),o(T,null,I(f.value,g=>(a(),j(_e,{key:g.id,feed:g},null,8,["feed"]))),128)),e("div",Be,p(u.value.total)+" 件中 "+p(f.value.length)+" 件表示 ",1),h.value?(a(),o("div",Ne,[e("button",{onClick:B,class:"btn btn-secondary",disabled:y(l)},[y(l)?(a(),o("i",Ve)):_("",!0),c[3]||(c[3]=C(" もっと見る ",-1))],8,Ae)])):_("",!0)])):(a(),o("div",ze," まだ投稿がありません。最初の投稿をしてみましょう！ "))]))}}),Ke={class:"flex items-start gap-3"},Je={class:"flex-1 min-w-0"},He={class:"font-medium text-gray-900 mb-1 line-clamp-2"},Re={class:"flex items-center gap-3 text-sm text-gray-500"},Oe={class:"flex items-center gap-1"},Xe=k({__name:"QaCard",props:{question:{}},setup(t){const v=M(),d=m=>new Date(m).toLocaleDateString("ja-JP",{month:"short",day:"numeric"});return(m,s)=>(a(),o("article",{class:"card card-hover",onClick:s[1]||(s[1]=n=>y(v).push(`/qa/${t.question.id}`))},[e("div",Ke,[e("div",{class:w(["flex-shrink-0 px-2 py-1 rounded text-xs font-medium",t.question.status==="resolved"?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"])},p(t.question.status==="resolved"?"解決済み":"受付中"),3),e("div",Je,[e("h3",He,p(t.question.title),1),e("div",Re,[e("span",null,p(t.question.user.display_name),1),e("span",null,p(d(t.question.created_at)),1),e("span",Oe,[s[2]||(s[2]=e("i",{class:"pi pi-comments text-xs"},null,-1)),C(" "+p(t.question.answer_count)+"件の回答 ",1)])]),e("div",{class:"mt-3 flex items-center gap-2",onClick:s[0]||(s[0]=F(()=>{},["stop"]))},[$(K,{"source-post":{id:t.question.id,type:"qa",title:t.question.title,user:t.question.user}},null,8,["source-post"]),s[3]||(s[3]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),$(G,{"post-id":t.question.id,reactions:t.question.reaction_counts},null,8,["post-id","reactions"])])])])]))}}),We={class:"space-y-6"},Ye={class:"flex justify-end"},Ze={key:0,class:"text-center py-8 text-gray-500"},et={key:1,class:"space-y-4"},tt={key:2,class:"text-center py-8 text-gray-500"},st=k({__name:"QaTab",setup(t){const v=M(),{data:d,isLoading:m}=E({queryKey:["qa"],queryFn:async()=>(await P.get("/qa")).data});return(s,n)=>{var r,i;return a(),o("div",We,[e("div",Ye,[e("button",{onClick:n[0]||(n[0]=l=>y(v).push("/qa/new")),class:"btn btn-primary"},[...n[1]||(n[1]=[e("i",{class:"pi pi-plus mr-2"},null,-1),C(" 質問する ",-1)])])]),y(m)?(a(),o("div",Ze,[...n[2]||(n[2]=[e("i",{class:"pi pi-spin pi-spinner text-2xl"},null,-1)])])):(i=(r=y(d))==null?void 0:r.data)!=null&&i.length?(a(),o("div",et,[(a(!0),o(T,null,I(y(d).data,l=>(a(),j(Xe,{key:l.id,question:l},null,8,["question"]))),128))])):(a(),o("div",tt," まだ質問がありません。最初の質問を投稿してみましょう！ "))])}}}),nt={class:"flex items-start gap-4"},at={class:"flex-1 min-w-0"},ot={class:"font-semibold text-gray-900 text-lg mb-1 line-clamp-2"},lt={class:"text-gray-500 text-sm line-clamp-2 mb-2"},rt={class:"flex items-center gap-3 text-sm text-gray-400"},it=k({__name:"BlogCard",props:{blog:{}},setup(t){const v=M(),d=m=>new Date(m).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"});return(m,s)=>(a(),o("article",{class:"card card-hover",onClick:s[1]||(s[1]=n=>y(v).push(`/blog/${t.blog.id}`))},[e("div",nt,[s[3]||(s[3]=e("div",{class:"flex-shrink-0 w-24 h-24 rounded-lg bg-gradient-to-br from-slate-100 to-slate-200 flex items-center justify-center"},[e("i",{class:"pi pi-book text-3xl text-slate-400"})],-1)),e("div",at,[e("h3",ot,p(t.blog.title),1),e("p",lt,p(t.blog.content),1),e("div",rt,[e("span",null,p(t.blog.user.display_name),1),e("span",null,p(d(t.blog.created_at)),1)]),e("div",{class:"mt-3 flex items-center gap-2",onClick:s[0]||(s[0]=F(()=>{},["stop"]))},[$(K,{"source-post":{id:t.blog.id,type:"blog",title:t.blog.title,user:t.blog.user}},null,8,["source-post"]),s[2]||(s[2]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),$(G,{"post-id":t.blog.id,reactions:t.blog.reaction_counts},null,8,["post-id","reactions"])])])])]))}}),dt={class:"space-y-6"},ut={class:"flex justify-end"},ct={key:0,class:"text-center py-8 text-gray-500"},mt={key:1,class:"space-y-4"},pt={key:2,class:"text-center py-8 text-gray-500"},gt=k({__name:"BlogTab",setup(t){const v=M(),{data:d,isLoading:m}=E({queryKey:["blogs"],queryFn:async()=>(await P.get("/blogs")).data});return(s,n)=>{var r,i;return a(),o("div",dt,[e("div",ut,[e("button",{onClick:n[0]||(n[0]=l=>y(v).push("/blog/new")),class:"btn btn-primary"},[...n[1]||(n[1]=[e("i",{class:"pi pi-plus mr-2"},null,-1),C(" ブログを書く ",-1)])])]),y(m)?(a(),o("div",ct,[...n[2]||(n[2]=[e("i",{class:"pi pi-spin pi-spinner text-2xl"},null,-1)])])):(i=(r=y(d))==null?void 0:r.data)!=null&&i.length?(a(),o("div",mt,[(a(!0),o(T,null,I(y(d).data,l=>(a(),j(it,{key:l.id,blog:l},null,8,["blog"]))),128))])):(a(),o("div",pt," まだブログがありません。最初のブログを書いてみましょう！ "))])}}}),vt={class:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100"},yt={class:"sticky top-0 z-50 bg-white/80 backdrop-blur-lg border-b border-gray-200"},xt={class:"max-w-4xl mx-auto px-4 py-3 flex items-center justify-between"},ft={class:"flex items-center gap-3"},bt={key:0,class:"text-sm text-gray-600"},ht={class:"sticky top-[57px] z-40 bg-white border-b border-gray-200"},_t={class:"max-w-4xl mx-auto px-4"},$t={class:"flex gap-1"},kt=["onClick"],wt={class:"max-w-4xl mx-auto px-4 py-6"},Mt=k({__name:"HomeView",setup(t){const v=M(),d=b("feed"),m=[{id:"feed",label:"つぶやき",icon:"pi pi-comment"},{id:"qa",label:"Q&A",icon:"pi pi-question-circle"},{id:"blog",label:"ブログ",icon:"pi pi-book"}],s=b(null);P.get("/me").then(r=>{s.value=r.data}).catch(()=>{});const n=()=>{localStorage.removeItem("token"),v.push("/login")};return(r,i)=>(a(),o("div",vt,[e("header",yt,[e("div",xt,[i[3]||(i[3]=e("h1",{class:"text-xl font-bold bg-gradient-to-r from-primary-500 to-primary-700 bg-clip-text text-transparent"}," SNS_2A ",-1)),e("div",ft,[e("button",{onClick:i[0]||(i[0]=l=>y(v).push("/search")),class:"btn btn-ghost p-2",title:"検索"},[...i[1]||(i[1]=[e("i",{class:"pi pi-search text-gray-600"},null,-1)])]),s.value?(a(),o("span",bt,p(s.value.display_name),1)):_("",!0),e("button",{onClick:n,class:"btn btn-ghost text-sm"},[...i[2]||(i[2]=[e("i",{class:"pi pi-sign-out mr-1"},null,-1),C(" ログアウト ",-1)])])])])]),e("nav",ht,[e("div",_t,[e("div",$t,[(a(),o(T,null,I(m,l=>e("button",{key:l.id,onClick:f=>d.value=l.id,class:w(["flex items-center gap-2 px-4 py-3 text-sm font-medium transition-all border-b-2 -mb-px",d.value===l.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[e("i",{class:w(l.icon)},null,2),C(" "+p(l.label),1)],10,kt)),64))])])]),e("main",wt,[$(R,{name:"fade",mode:"out-in"},{default:O(()=>[d.value==="feed"?(a(),j(Ge,{key:0})):d.value==="qa"?(a(),j(st,{key:1})):d.value==="blog"?(a(),j(gt,{key:2})):_("",!0)]),_:1})])]))}});export{Mt as default};
